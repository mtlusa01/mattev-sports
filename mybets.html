<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Bets | Edge Factor Elite</title>
  <meta name="description" content="Track your bets and view your betting history with Edge Factor Elite.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #111118;
      --bg-tertiary: #1a1a24;
      --bg-elevated: rgba(37, 37, 50, 0.5);
      --border: rgba(255, 255, 255, 0.08);
      --border-light: rgba(255, 255, 255, 0.12);
      --text-primary: #f0f0f0;
      --text-secondary: #9ca3af;
      --text-muted: #6b7280;
      --brand: #dc2626;
      --brand-light: #ef4444;
      --brand-glow: rgba(220, 38, 38, 0.15);
      --brand-border: rgba(220, 38, 38, 0.3);
      --accent: #10b981;
      --accent-light: #34d399;
      --accent-glow: rgba(16, 185, 129, 0.15);
      --red: #ef4444;
      --red-light: #f87171;
      --yellow: #f59e0b;
      --blue: #3b82f6;
      --purple: #8b5cf6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    .page-gradient {
      position: fixed; top: 0; left: 0; right: 0; height: 60vh;
      background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(220, 38, 38, 0.08), transparent);
      pointer-events: none; z-index: 0;
    }

    /* ── Top Nav ── */
    .top-nav {
      background: var(--bg-primary);
      position: fixed; top: 0; left: 0; right: 0; height: 60px; z-index: 100;
      display: flex; align-items: center;
      border-bottom: 1px solid var(--border);
    }
    .top-nav-inner {
      max-width: 1400px; margin: 0 auto; padding: 0 1.5rem; width: 100%; height: 100%;
      display: flex; align-items: center; justify-content: space-between;
    }
    .logo { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; }
    .brand-logo-circle {
      width: 44px; height: 44px; border-radius: 50%; overflow: hidden;
      border: 2px solid var(--brand); box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
      transition: all 0.2s;
    }
    .brand-logo-img { width: 100%; height: 100%; object-fit: cover; }
    .brand-name { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em; }
    .brand-name .brand-elite { color: var(--brand-light); font-weight: 800; }
    .logo:hover .brand-logo-circle { border-color: var(--brand-light); transform: scale(1.05); }
    .nav-right { display: flex; align-items: center; gap: 1.5rem; }
    .nav-link { color: #a0a0a0; text-decoration: none; font-size: 0.9rem; font-weight: 500; transition: color 0.2s; }
    .nav-link:hover { color: #ffffff; }
    .nav-link.active { color: var(--brand-light); }

    /* ── Main Container ── */
    .main-container {
      max-width: 1200px; margin: 0 auto; padding: 80px 1.5rem 2rem;
      position: relative; z-index: 1;
    }

    .page-header {
      margin-bottom: 2rem;
    }
    .page-title {
      font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;
    }
    .page-subtitle {
      color: var(--text-secondary); font-size: 0.95rem;
    }

    /* ── Stats Cards ── */
    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px;
      padding: 20px; text-align: center;
    }
    .stat-value { font-size: 2rem; font-weight: 700; margin-bottom: 4px; }
    .stat-value.positive { color: var(--accent); }
    .stat-value.negative { color: var(--red-light); }
    .stat-value.neutral { color: var(--text-primary); }
    .stat-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

    /* ── Filters ── */
    .filters-bar {
      display: flex; align-items: center; gap: 12px; margin-bottom: 1.5rem; flex-wrap: wrap;
    }
    .filter-btn {
      padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border);
      background: var(--bg-secondary); color: var(--text-secondary); font-size: 13px; font-weight: 600;
      cursor: pointer; transition: all 0.15s;
    }
    .filter-btn:hover { border-color: var(--border-light); color: var(--text-primary); }
    .filter-btn.active { background: var(--brand); border-color: var(--brand); color: #fff; }
    .filter-btn.active-green { background: var(--accent); border-color: var(--accent); color: #fff; }
    .filter-btn.active-red { background: var(--red); border-color: var(--red); color: #fff; }

    .clear-btn {
      margin-left: auto; padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border);
      background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s;
    }
    .clear-btn:hover { border-color: var(--red); color: var(--red-light); }

    /* ── Bets Table ── */
    .bets-table-container {
      background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px;
      overflow: hidden;
    }
    .bets-table {
      width: 100%; border-collapse: collapse;
    }
    .bets-table th {
      text-align: left; padding: 14px 16px; font-size: 11px; font-weight: 600;
      color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border); background: var(--bg-tertiary);
    }
    .bets-table td {
      padding: 14px 16px; border-bottom: 1px solid var(--border); font-size: 14px;
      vertical-align: middle;
    }
    .bets-table tr:last-child td { border-bottom: none; }
    .bets-table tr:hover { background: rgba(255,255,255,0.02); }

    .bet-pick { font-weight: 600; color: var(--text-primary); }
    .bet-game { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
    .bet-type { font-size: 11px; font-weight: 600; padding: 3px 8px; border-radius: 4px; text-transform: uppercase; }
    .bet-type.prop { background: rgba(139, 92, 246, 0.2); color: var(--purple); }
    .bet-type.spread { background: rgba(59, 130, 246, 0.2); color: var(--blue); }
    .bet-type.total { background: rgba(245, 158, 11, 0.2); color: var(--yellow); }
    .bet-type.ml { background: rgba(16, 185, 129, 0.2); color: var(--accent); }

    .bet-status { font-size: 12px; font-weight: 600; padding: 4px 10px; border-radius: 6px; }
    .bet-status.pending { background: rgba(107, 114, 128, 0.2); color: var(--text-secondary); }
    .bet-status.win { background: rgba(16, 185, 129, 0.2); color: var(--accent); }
    .bet-status.loss { background: rgba(239, 68, 68, 0.2); color: var(--red-light); }
    .bet-status.push { background: rgba(245, 158, 11, 0.2); color: var(--yellow); }

    .bet-profit { font-weight: 600; }
    .bet-profit.positive { color: var(--accent); }
    .bet-profit.negative { color: var(--red-light); }
    .bet-profit.neutral { color: var(--text-muted); }

    .bet-delete {
      background: none; border: none; color: var(--text-muted); cursor: pointer;
      font-size: 16px; padding: 4px 8px; opacity: 0.5; transition: all 0.15s;
    }
    .bet-delete:hover { opacity: 1; color: var(--red-light); }

    .empty-state {
      text-align: center; padding: 60px 20px; color: var(--text-muted);
    }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state-title { font-size: 18px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
    .empty-state-text { font-size: 14px; }
    .empty-state a { color: var(--brand-light); text-decoration: none; }
    .empty-state a:hover { text-decoration: underline; }

    /* ── Settings Card ── */
    .settings-card {
      background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px;
      padding: 24px; margin-top: 2rem;
    }
    .settings-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; color: var(--text-secondary); }
    .settings-row {
      display: flex; align-items: center; gap: 16px; margin-bottom: 12px;
    }
    .settings-row:last-child { margin-bottom: 0; }
    .settings-label { font-size: 13px; color: var(--text-muted); min-width: 100px; }
    .settings-input {
      padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border);
      background: var(--bg-primary); color: var(--text-primary); font-size: 14px; width: 120px;
    }
    .settings-input:focus { outline: none; border-color: var(--brand-border); }

    /* ── Mobile ── */
    @media (max-width: 768px) {
      .nav-right { display: none; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .bets-table th, .bets-table td { padding: 10px 12px; font-size: 12px; }
      .col-hide-mobile { display: none; }
    }

    /* ── Confirm Modal ── */
    .confirm-modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200;
      opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s;
    }
    .confirm-modal-backdrop.visible { opacity: 1; visibility: visible; }
    .confirm-modal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);
      width: calc(100% - 32px); max-width: 400px; background: var(--bg-secondary);
      border: 1px solid var(--border); border-radius: 16px; padding: 24px;
      z-index: 201; opacity: 0; visibility: hidden; transition: all 0.2s;
      text-align: center;
    }
    .confirm-modal.visible { opacity: 1; visibility: visible; transform: translate(-50%, -50%) scale(1); }
    .confirm-modal-title { font-size: 18px; font-weight: 600; margin-bottom: 12px; }
    .confirm-modal-text { font-size: 14px; color: var(--text-secondary); margin-bottom: 24px; }
    .confirm-modal-actions { display: flex; gap: 12px; }
    .confirm-btn {
      flex: 1; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none;
    }
    .confirm-btn.cancel { background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border); }
    .confirm-btn.cancel:hover { background: var(--bg-elevated); }
    .confirm-btn.danger { background: var(--red); color: #fff; }
    .confirm-btn.danger:hover { background: #dc2626; }
  </style>
</head>
<body>
  <div class="page-gradient"></div>

  <nav class="top-nav">
    <div class="top-nav-inner">
      <a href="dashboard.html" class="logo">
        <div class="brand-logo-circle">
          <img src="logo.png" alt="EFE" class="brand-logo-img" onerror="this.style.display='none'">
        </div>
        <span class="brand-name">Edge Factor <span class="brand-elite">Elite</span></span>
      </a>
      <div class="nav-right">
        <a href="dashboard.html" class="nav-link">Dashboard</a>
        <a href="results.html" class="nav-link">Results</a>
        <a href="mybets.html" class="nav-link active">My Bets</a>
        <a href="about.html" class="nav-link">About</a>
      </div>
    </div>
  </nav>

  <main class="main-container">
    <div class="page-header">
      <h1 class="page-title">My Bets</h1>
      <p class="page-subtitle">Track your bets and monitor your performance</p>
    </div>

    <div class="stats-grid" id="stats-grid"></div>

    <div class="filters-bar">
      <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
      <button class="filter-btn" data-filter="pending" onclick="setFilter('pending')">Pending</button>
      <button class="filter-btn" data-filter="win" onclick="setFilter('win')">Wins</button>
      <button class="filter-btn" data-filter="loss" onclick="setFilter('loss')">Losses</button>
      <button class="clear-btn" onclick="showClearConfirm()">Clear All</button>
    </div>

    <div class="bets-table-container" id="bets-container"></div>

    <div class="settings-card">
      <div class="settings-title">Bet Settings</div>
      <div class="settings-row">
        <span class="settings-label">Unit Size ($)</span>
        <input type="number" class="settings-input" id="unit-size" value="10" min="1" onchange="saveSettings()">
      </div>
    </div>
  </main>

  <!-- Confirm Modal -->
  <div class="confirm-modal-backdrop" id="confirm-backdrop" onclick="hideConfirm()"></div>
  <div class="confirm-modal" id="confirm-modal">
    <div class="confirm-modal-title" id="confirm-title">Clear All Bets?</div>
    <div class="confirm-modal-text" id="confirm-text">This will permanently delete all tracked bets. This action cannot be undone.</div>
    <div class="confirm-modal-actions">
      <button class="confirm-btn cancel" onclick="hideConfirm()">Cancel</button>
      <button class="confirm-btn danger" id="confirm-action" onclick="confirmClearAll()">Clear All</button>
    </div>
  </div>

  <script>
    const LS_SETTINGS = 'efe_user_settings';
    const LS_BETS = 'efe_tracked_bets';

    function getBetSettings() {
      try { return JSON.parse(localStorage.getItem(LS_SETTINGS)) || {}; }
      catch { return {}; }
    }
    function saveBetSettings(s) { localStorage.setItem(LS_SETTINGS, JSON.stringify(s)); }
    function getTrackedBets() {
      try { return JSON.parse(localStorage.getItem(LS_BETS)) || []; }
      catch { return []; }
    }
    function saveTrackedBets(bets) { localStorage.setItem(LS_BETS, JSON.stringify(bets)); }
    function getUnitSize() { return getBetSettings().unit_size || 10; }

    function calcProfit(odds, units) {
      const o = parseInt(odds);
      if (isNaN(o)) return 0;
      if (o > 0) return units * (o / 100);
      return units * (100 / Math.abs(o));
    }

    let currentFilter = 'all';
    let pendingAction = null;

    function setFilter(filter) {
      currentFilter = filter;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active', 'active-green', 'active-red');
        if (btn.dataset.filter === filter) {
          if (filter === 'win') btn.classList.add('active-green');
          else if (filter === 'loss') btn.classList.add('active-red');
          else btn.classList.add('active');
        }
      });
      renderBets();
    }

    function renderStats() {
      const bets = getTrackedBets();
      const unitSize = getUnitSize();

      const pending = bets.filter(b => b.status === 'pending').length;
      const wins = bets.filter(b => b.status === 'win').length;
      const losses = bets.filter(b => b.status === 'loss').length;
      const pushes = bets.filter(b => b.status === 'push').length;
      const graded = wins + losses + pushes;
      const winRate = graded > 0 ? ((wins / graded) * 100).toFixed(1) : '0.0';

      let totalUnits = 0;
      for (const b of bets) {
        if (b.profit_units != null) totalUnits += b.profit_units;
      }
      const totalDollars = totalUnits * unitSize;

      const profitClass = totalUnits > 0 ? 'positive' : totalUnits < 0 ? 'negative' : 'neutral';
      const profitSign = totalUnits >= 0 ? '+' : '';

      document.getElementById('stats-grid').innerHTML = `
        <div class="stat-card">
          <div class="stat-value neutral">${bets.length}</div>
          <div class="stat-label">Total Bets</div>
        </div>
        <div class="stat-card">
          <div class="stat-value neutral">${pending}</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
          <div class="stat-value positive">${wins}-${losses}</div>
          <div class="stat-label">Record</div>
        </div>
        <div class="stat-card">
          <div class="stat-value ${winRate >= 50 ? 'positive' : 'negative'}">${winRate}%</div>
          <div class="stat-label">Win Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-value ${profitClass}">${profitSign}${totalUnits.toFixed(2)}u</div>
          <div class="stat-label">Profit (Units)</div>
        </div>
        <div class="stat-card">
          <div class="stat-value ${profitClass}">${profitSign}$${totalDollars.toFixed(2)}</div>
          <div class="stat-label">Profit ($)</div>
        </div>
      `;
    }

    function renderBets() {
      const bets = getTrackedBets();
      const unitSize = getUnitSize();

      let filtered = bets;
      if (currentFilter !== 'all') {
        filtered = bets.filter(b => b.status === currentFilter);
      }

      // Sort: pending first, then by date descending
      filtered.sort((a, b) => {
        if (a.status === 'pending' && b.status !== 'pending') return -1;
        if (b.status === 'pending' && a.status !== 'pending') return 1;
        return new Date(b.placed_at) - new Date(a.placed_at);
      });

      if (filtered.length === 0) {
        const msg = currentFilter === 'all'
          ? 'You haven\'t tracked any bets yet. <a href="dashboard.html">Go to Dashboard</a> to start tracking.'
          : `No ${currentFilter} bets found.`;
        document.getElementById('bets-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#127919;</div>
            <div class="empty-state-title">No bets to show</div>
            <div class="empty-state-text">${msg}</div>
          </div>
        `;
        return;
      }

      const rows = filtered.map((b, idx) => {
        const typeClass = b.type === 'prop' ? 'prop' : b.type;
        const typeLabel = b.type === 'prop' ? b.prop_type?.toUpperCase() || 'PROP' : b.type.toUpperCase();
        const pickDesc = b.type === 'prop'
          ? `${b.player} ${b.pick} ${b.line}`
          : b.pick;
        const gameStr = b.game || '';
        const dateStr = new Date(b.placed_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        const oddsStr = b.odds > 0 ? `+${b.odds}` : b.odds;

        let profitStr = '--';
        let profitClass = 'neutral';
        if (b.profit_units != null) {
          const profitDollars = b.profit_units * unitSize;
          profitStr = (b.profit_units >= 0 ? '+' : '') + b.profit_units.toFixed(2) + 'u';
          profitClass = b.profit_units > 0 ? 'positive' : b.profit_units < 0 ? 'negative' : 'neutral';
        }

        const origIdx = bets.findIndex(x => x.id === b.id);

        return `
          <tr>
            <td>
              <div class="bet-pick">${pickDesc}</div>
              <div class="bet-game">${gameStr}</div>
            </td>
            <td><span class="bet-type ${typeClass}">${typeLabel}</span></td>
            <td class="col-hide-mobile">${b.sport || 'NBA'}</td>
            <td>${oddsStr}</td>
            <td>${b.units}u</td>
            <td class="col-hide-mobile">${b.book || '--'}</td>
            <td><span class="bet-status ${b.status}">${b.status}</span></td>
            <td><span class="bet-profit ${profitClass}">${profitStr}</span></td>
            <td class="col-hide-mobile">${dateStr}</td>
            <td><button class="bet-delete" onclick="deleteBet(${origIdx})" title="Delete bet">&#10005;</button></td>
          </tr>
        `;
      }).join('');

      document.getElementById('bets-container').innerHTML = `
        <table class="bets-table">
          <thead>
            <tr>
              <th>Pick</th>
              <th>Type</th>
              <th class="col-hide-mobile">Sport</th>
              <th>Odds</th>
              <th>Units</th>
              <th class="col-hide-mobile">Book</th>
              <th>Status</th>
              <th>P/L</th>
              <th class="col-hide-mobile">Date</th>
              <th></th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    function deleteBet(idx) {
      const bets = getTrackedBets();
      if (idx >= 0 && idx < bets.length) {
        bets.splice(idx, 1);
        saveTrackedBets(bets);
        renderStats();
        renderBets();
      }
    }

    function showClearConfirm() {
      const bets = getTrackedBets();
      if (bets.length === 0) return;
      document.getElementById('confirm-backdrop').classList.add('visible');
      document.getElementById('confirm-modal').classList.add('visible');
    }

    function hideConfirm() {
      document.getElementById('confirm-backdrop').classList.remove('visible');
      document.getElementById('confirm-modal').classList.remove('visible');
    }

    function confirmClearAll() {
      saveTrackedBets([]);
      hideConfirm();
      renderStats();
      renderBets();
    }

    function saveSettings() {
      const unitSize = parseFloat(document.getElementById('unit-size').value) || 10;
      const settings = getBetSettings();
      settings.unit_size = unitSize;
      saveBetSettings(settings);
      renderStats();
      renderBets();
    }

    function loadSettings() {
      const settings = getBetSettings();
      document.getElementById('unit-size').value = settings.unit_size || 10;
    }

    // Initialize
    loadSettings();
    renderStats();
    renderBets();
  </script>
</body>
</html>
