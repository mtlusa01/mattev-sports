<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Edge Factor Elite</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #080c14;
      --bg-secondary: #0c1220;
      --bg-card: #111827;
      --bg-card-hover: #162032;
      --accent: #00d4ff;
      --accent-secondary: #38bdf8;
      --accent-soft: rgba(0,212,255,0.10);
      --profit: #22c55e;
      --profit-soft: rgba(34,197,94,0.12);
      --loss: #ef4444;
      --loss-soft: rgba(239,68,68,0.12);
      --warning: #f59e0b;
      --warning-soft: rgba(245,158,11,0.12);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-tertiary: #64748b;
      --text-muted: #475569;
      --border-subtle: rgba(148,163,184,0.08);
      --border: rgba(148,163,184,0.12);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed; top: -15%; left: -10%;
      width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(0,212,255,0.06) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }
    body::after {
      content: '';
      position: fixed; bottom: -15%; right: -10%;
      width: 600px; height: 600px;
      background: radial-gradient(circle, rgba(34,197,94,0.04) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    .mono { font-family: 'JetBrains Mono', monospace; }

    /* ── Animations ── */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .anim { opacity: 0; animation: fadeInUp 0.5s ease-out forwards; }
    .d1 { animation-delay: 0.05s; }
    .d2 { animation-delay: 0.10s; }
    .d3 { animation-delay: 0.15s; }
    .d4 { animation-delay: 0.20s; }
    .d5 { animation-delay: 0.25s; }
    .d6 { animation-delay: 0.30s; }

    /* ── Auth Gate ── */
    .auth-gate {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      z-index: 9000; background: var(--bg-primary);
      flex-direction: column; align-items: center; justify-content: center; gap: 16px;
    }
    .auth-gate.visible { display: flex; }
    .auth-gate .logo-mark { width: 48px; height: 48px; font-size: 16px; border-radius: 12px; margin-bottom: 8px; }
    .auth-gate h2 { font-size: 24px; font-weight: 700; color: var(--text-primary); }
    .auth-gate p { font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; }
    .google-btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 12px 28px; border-radius: var(--radius-md); border: 1px solid var(--border);
      background: var(--bg-card); color: var(--text-primary); font-family: inherit;
      font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
    }
    .google-btn:hover { background: var(--bg-card-hover); border-color: var(--accent); }

    /* ── Navigation ── */
    .nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
      height: 60px; background: rgba(8,12,20,0.88);
      backdrop-filter: blur(24px) saturate(1.3); -webkit-backdrop-filter: blur(24px) saturate(1.3);
      border-bottom: 1px solid var(--border-subtle);
    }
    .nav-inner {
      max-width: 1280px; margin: 0 auto; padding: 0 24px;
      display: flex; align-items: center; justify-content: space-between; height: 100%;
    }
    .nav-left { display: flex; align-items: center; gap: 12px; text-decoration: none; }
    .logo-mark {
      width: 32px; height: 32px; border-radius: 8px;
      background: linear-gradient(135deg, #00d4ff, #38bdf8);
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 11px; color: #fff; flex-shrink: 0;
      font-family: 'JetBrains Mono', monospace;
      box-shadow: 0 0 12px rgba(0,212,255,0.2);
    }
    .logo-text { font-size: 15px; font-weight: 700; color: var(--text-primary); white-space: nowrap; }
    .logo-text span { color: #00d4ff; }

    .nav-center { display: flex; align-items: center; gap: 4px; }
    .nav-link {
      color: var(--text-tertiary); text-decoration: none; font-size: 13px; font-weight: 500;
      padding: 8px 14px; border-radius: var(--radius-sm); transition: all 0.2s; position: relative;
    }
    .nav-link:hover { color: var(--text-secondary); background: rgba(148,163,184,0.06); }
    .nav-link.active { color: var(--text-primary); font-weight: 600; text-shadow: 0 0 12px rgba(0,212,255,0.3); }
    .nav-link.active::after {
      content: ''; position: absolute; bottom: -13px; left: 12px; right: 12px;
      height: 2px; background: var(--accent); border-radius: 1px;
    }

    .nav-actions { position: relative; }
    .dropdown-trigger {
      display: flex; align-items: center; gap: 8px; padding: 5px 10px 5px 5px;
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: 24px; cursor: pointer; transition: border-color 0.2s; user-select: none;
    }
    .dropdown-trigger:hover { border-color: var(--border); }
    .dropdown-trigger.open { border-color: var(--accent); }
    .dropdown-avatar {
      width: 30px; height: 30px; border-radius: 50%;
      background: linear-gradient(135deg, #00d4ff, #38bdf8);
      box-shadow: 0 0 12px rgba(0,212,255,0.2);
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-weight: 700; font-size: 12px; flex-shrink: 0;
    }
    .dropdown-trigger-name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
    .dropdown-chevron {
      font-size: 10px; color: var(--text-tertiary); transition: transform 0.2s;
    }
    .dropdown-trigger.open .dropdown-chevron { transform: rotate(180deg); }

    .user-dropdown {
      position: absolute; top: calc(100% + 8px); right: 0; width: 240px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--radius-md); padding: 8px 0;
      opacity: 0; transform: translateY(-8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none; z-index: 1001;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .user-dropdown.open { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-user { padding: 12px 16px; border-bottom: 1px solid var(--border-subtle); }
    .dropdown-name { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
    .dropdown-email {
      font-size: 12px; color: var(--text-tertiary); white-space: nowrap;
      overflow: hidden; text-overflow: ellipsis; max-width: 208px; margin-bottom: 8px;
    }
    .dropdown-tier {
      display: inline-block; font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.05em; padding: 2px 8px; border-radius: 10px;
      background: var(--accent-soft); color: var(--accent-secondary);
    }
    .dropdown-divider { height: 1px; background: var(--border-subtle); margin: 4px 0; }
    .dropdown-item {
      display: block; width: 100%; padding: 8px 16px; font-size: 13px; font-weight: 500;
      color: var(--text-secondary); background: none; border: none;
      text-decoration: none; text-align: left; cursor: pointer;
      font-family: inherit; transition: all 0.15s;
    }
    .dropdown-item:hover { color: var(--text-primary); background: rgba(148,163,184,0.06); }
    .dropdown-item.danger:hover { color: var(--loss); background: var(--loss-soft); }

    /* ── Mobile ── */
    .mobile-btn {
      display: none; background: none; border: none; color: var(--text-secondary);
      cursor: pointer; padding: 8px; border-radius: var(--radius-sm);
    }
    .mobile-btn svg { width: 22px; height: 22px; display: block; }
    .mobile-drawer {
      display: none; position: fixed; top: 60px; left: 0; right: 0; z-index: 999;
      background: rgba(8,12,20,0.98); backdrop-filter: blur(24px) saturate(1.3);
      border-bottom: 1px solid var(--border-subtle); padding: 8px 16px 16px;
    }
    .mobile-drawer.open { display: block; }
    .mobile-drawer a {
      display: block; padding: 12px 16px; color: var(--text-secondary);
      text-decoration: none; font-size: 15px; font-weight: 500;
      border-radius: var(--radius-sm); transition: all 0.15s;
    }
    .mobile-drawer a:hover, .mobile-drawer a.active {
      color: var(--text-primary); background: rgba(148,163,184,0.06);
    }
    .mobile-drawer a.active { border-left: 2px solid var(--accent); }

    /* ── Page Layout ── */
    .page { max-width: 1280px; margin: 0 auto; padding: 84px 24px 48px; position: relative; z-index: 1; }

    .page-header { margin-bottom: 28px; }
    .page-greeting {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.08em; color: var(--accent-secondary); margin-bottom: 4px;
    }
    .page-title { font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
    .page-subtitle { font-size: 13px; color: var(--text-tertiary); display: flex; align-items: center; gap: 0; flex-wrap: wrap; }
    .subtitle-sep { width: 1px; height: 14px; background: var(--border); margin: 0 12px; flex-shrink: 0; }

    /* ── Portfolio Hero ── */
    .hero-grid {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 28px;
    }
    .stat-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 20px;
      border-top: 2px solid transparent;
      transition: all 0.25s ease;
    }
    .stat-card:hover {
      transform: translateY(-1px); border-color: var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    .stat-card:nth-child(1):hover { border-top-color: var(--accent); }
    .stat-card:nth-child(2):hover { border-top-color: var(--profit); }
    .stat-card:nth-child(3):hover { border-top-color: var(--accent); }
    .stat-card:nth-child(4):hover { border-top-color: #3b82f6; }
    .stat-icon {
      width: 28px; height: 28px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; margin-bottom: 12px;
    }
    .stat-icon.indigo { background: var(--accent-soft); }
    .stat-icon.green { background: var(--profit-soft); }
    .stat-icon.blue { background: rgba(59,130,246,0.12); }
    .stat-label {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.05em; color: var(--text-tertiary); margin-bottom: 6px;
    }
    .stat-value {
      font-family: 'JetBrains Mono', monospace; font-size: 26px; font-weight: 700;
      color: var(--text-primary); line-height: 1; margin-bottom: 6px;
    }
    .stat-change { font-size: 12px; color: var(--text-muted); }
    .stat-change.profit { color: var(--profit); }
    .stat-change.loss { color: var(--loss); }

    /* ── Content Grid ── */
    .content-grid {
      display: grid; grid-template-columns: 1fr 380px; gap: 24px;
    }

    /* ── Section Headers ── */
    .section { margin-bottom: 24px; }
    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 16px;
    }
    .section-title { font-size: 16px; font-weight: 700; color: var(--text-primary); }
    .section-link {
      font-size: 12px; font-weight: 600; color: var(--accent-secondary);
      text-decoration: none; transition: color 0.2s;
    }
    .section-link:hover { color: var(--accent); }

    /* ── Model Cards ── */
    .models-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .model-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 18px; text-decoration: none;
      border-top: 2px solid transparent;
      transition: all 0.25s ease; display: block; position: relative; overflow: hidden;
    }
    .model-card:hover {
      transform: translateY(-1px); border-color: var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    .model-card.nba:hover { border-top-color: var(--loss); }
    .model-card.ncaab:hover { border-top-color: #3b82f6; }
    .model-card.nhl:hover { border-top-color: var(--profit); }
    .model-card.props:hover { border-top-color: var(--accent); }
    .model-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .model-badge {
      font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em;
      padding: 3px 8px; border-radius: var(--radius-sm);
    }
    .model-badge.nba { background: var(--loss-soft); color: var(--loss); }
    .model-badge.ncaab { background: rgba(59,130,246,0.12); color: #60a5fa; }
    .model-badge.nhl { background: var(--profit-soft); color: var(--profit); }
    .model-badge.props { background: var(--accent-soft); color: var(--accent-secondary); }
    .model-status {
      display: flex; align-items: center; gap: 5px;
      font-size: 11px; color: var(--text-tertiary);
    }
    .model-dot {
      width: 6px; height: 6px; border-radius: 50%; background: var(--profit);
      box-shadow: 0 0 6px rgba(34,197,94,0.4);
    }
    .model-name { font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
    .model-stats { display: flex; gap: 20px; margin-bottom: 14px; }
    .model-stat-label { font-size: 10px; font-weight: 600; text-transform: uppercase; color: var(--text-muted); margin-bottom: 2px; }
    .model-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 15px; font-weight: 600; color: var(--text-primary); }
    .model-bar { height: 3px; background: rgba(148,163,184,0.08); border-radius: 2px; overflow: hidden; }
    .model-bar-fill {
      height: 100%; border-radius: 2px; min-width: 2px;
      transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
    }
    .model-bar-fill.excellent { background: linear-gradient(90deg, var(--profit), #4ade80); }
    .model-bar-fill.good { background: linear-gradient(90deg, #00d4ff, #38bdf8); }

    /* ── Recent Picks ── */
    .pick-item {
      display: flex; align-items: center; gap: 12px;
      padding: 11px 0; border-bottom: 1px solid var(--border-subtle);
    }
    .pick-item:last-child { border-bottom: none; }
    .pick-badge {
      font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 700;
      width: 28px; height: 28px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .pick-badge.win { background: var(--profit-soft); color: var(--profit); }
    .pick-badge.loss { background: var(--loss-soft); color: var(--loss); }
    .pick-badge.pending { background: rgba(148,163,184,0.08); color: var(--text-muted); }
    .pick-info { flex: 1; min-width: 0; }
    .pick-matchup { font-size: 13px; font-weight: 600; color: var(--text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pick-meta { font-size: 11px; color: var(--text-muted); }
    .pick-edge {
      font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 600;
      color: var(--text-tertiary); flex-shrink: 0;
    }
    .picks-empty { padding: 24px 0; text-align: center; color: var(--text-muted); font-size: 13px; }

    /* ── Monthly Goal ── */
    .goal-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px;
      border-top: 2px solid transparent;
      transition: all 0.25s ease;
    }
    .goal-card:hover {
      transform: translateY(-1px); border-color: var(--border); border-top-color: var(--accent);
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    .goal-header { font-size: 14px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
    .goal-amount {
      font-family: 'JetBrains Mono', monospace; font-size: 20px; font-weight: 700;
      color: var(--text-primary); text-align: center; margin-bottom: 16px;
    }
    .goal-amount span { color: var(--text-muted); font-weight: 500; }
    .goal-ring-wrap { display: flex; justify-content: center; margin-bottom: 16px; }
    .goal-svg { display: block; }
    .goal-rows { margin-bottom: 12px; }
    .goal-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 6px 0; font-size: 13px;
    }
    .goal-row-label { color: var(--text-tertiary); }
    .goal-row-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--text-primary); font-size: 13px; }
    .goal-footer {
      font-size: 12px; color: var(--text-muted); text-align: center;
      padding-top: 10px; border-top: 1px solid var(--border-subtle);
    }

    /* ── Quick Actions ── */
    .actions-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 16px; margin-bottom: 16px;
    }
    .action-btn {
      display: flex; align-items: center; gap: 12px; padding: 10px 12px;
      background: none; border: none; border-radius: var(--radius-md);
      text-decoration: none; color: var(--text-primary); width: 100%;
      font-family: inherit; cursor: pointer; transition: background 0.2s;
    }
    .action-btn:hover { background: rgba(148,163,184,0.06); }
    .action-icon {
      width: 32px; height: 32px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 14px; flex-shrink: 0;
    }
    .action-icon.indigo { background: var(--accent-soft); }
    .action-icon.orange { background: var(--warning-soft); }
    .action-icon.green { background: var(--profit-soft); }
    .action-text { flex: 1; font-size: 13px; font-weight: 600; text-align: left; }
    .action-arrow {
      color: var(--text-muted); font-size: 14px; transition: transform 0.2s;
    }
    .action-btn:hover .action-arrow { transform: translateX(3px); }

    /* ── Platform Status ── */
    .status-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 20px;
    }
    .status-card:hover {
      border-color: var(--border);
    }
    .status-title { font-size: 14px; font-weight: 700; color: var(--text-primary); margin-bottom: 14px; }
    .status-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 7px 0; font-size: 13px;
    }
    .status-left { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); }
    .status-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
    .status-dot.active { background: var(--profit); box-shadow: 0 0 6px rgba(34,197,94,0.4); }
    .status-dot.idle { background: var(--text-muted); }
    .status-val { font-size: 12px; font-weight: 600; color: var(--text-tertiary); }
    .status-val.live { color: var(--profit); }

    /* ── Responsive ── */
    @media (max-width: 1024px) {
      .content-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 768px) {
      .hero-grid { grid-template-columns: 1fr 1fr; }
      .models-grid { grid-template-columns: 1fr; }
      .nav-center { display: none; }
      .mobile-btn { display: block; }
      .page { padding: 76px 16px 32px; }
    }
    @media (max-width: 480px) {
      .hero-grid { grid-template-columns: 1fr; }
      .page-title { font-size: 22px; }
      .dropdown-trigger-name { display: none; }
    }

    /* ── Betting Calendar ── */
    .cal-section { margin-top: 32px; }
    .cal-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 24px; transition: border-color 0.25s;
    }
    .cal-card:hover { border-color: var(--border); }
    .cal-nav {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;
    }
    .cal-nav-btn {
      background: none; border: 1px solid var(--border-subtle);
      color: var(--text-secondary); width: 32px; height: 32px;
      border-radius: var(--radius-sm); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; transition: all 0.2s;
    }
    .cal-nav-btn:hover { border-color: var(--accent); color: var(--accent); }
    .cal-month-label { font-size: 16px; font-weight: 700; color: var(--text-primary); }
    .cal-weekdays {
      display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 4px;
    }
    .cal-weekday {
      text-align: center; font-size: 10px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.05em;
      color: var(--text-muted); padding: 6px 0;
    }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .cal-day {
      min-height: 72px; background: var(--bg-secondary);
      border: 2px solid transparent; border-radius: var(--radius-md);
      padding: 6px 8px; cursor: default; transition: all 0.2s;
      position: relative; display: flex; flex-direction: column;
    }
    .cal-day:hover { border-color: var(--border); background: var(--bg-card-hover); }
    .cal-day.cal-today { border-color: var(--accent); box-shadow: 0 0 12px rgba(0,212,255,0.15); }
    .cal-day.cal-other-month { opacity: 0.25; }
    .cal-day.cal-selected { border-color: var(--accent); background: var(--bg-card-hover); }
    .cal-day.cal-has-bets { cursor: pointer; }
    .cal-day-num { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; }
    .cal-day.cal-today .cal-day-num { color: var(--accent); }
    .cal-day-record {
      font-size: 9px; font-weight: 700; padding: 2px 5px;
      border-radius: 8px; display: inline-block; width: fit-content;
      font-family: 'JetBrains Mono', monospace; line-height: 1;
    }
    .cal-day-record.win { background: var(--profit-soft); color: var(--profit); }
    .cal-day-record.loss { background: var(--loss-soft); color: var(--loss); }
    .cal-day-record.mixed { background: var(--warning-soft); color: var(--warning); }
    .cal-day-record.pending { background: rgba(148,163,184,0.08); color: var(--text-muted); }
    .cal-day-pnl {
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px; font-weight: 600; margin-top: auto;
    }
    .cal-day-pnl.profit { color: var(--profit); }
    .cal-day-pnl.loss { color: var(--loss); }
    .cal-day-dot {
      position: absolute; top: 6px; right: 6px;
      width: 6px; height: 6px; border-radius: 50%;
    }
    .cal-day-dot.profit { background: var(--profit); box-shadow: 0 0 6px rgba(34,197,94,0.4); }
    .cal-day-dot.loss { background: var(--loss); box-shadow: 0 0 6px rgba(239,68,68,0.4); }
    .cal-day-dot.pending { background: var(--text-muted); }

    .cal-detail {
      margin-top: 16px; padding: 20px;
      background: var(--bg-secondary); border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      animation: fadeInUp 0.3s ease-out;
    }
    .cal-detail-header {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;
    }
    .cal-detail-date { font-size: 15px; font-weight: 700; color: var(--text-primary); }
    .cal-detail-close {
      background: none; border: none; color: var(--text-muted);
      cursor: pointer; font-size: 18px; padding: 4px 8px;
      border-radius: var(--radius-sm); transition: all 0.2s;
    }
    .cal-detail-close:hover { color: var(--text-primary); background: rgba(148,163,184,0.08); }
    .cal-detail-summary {
      display: flex; gap: 20px; padding: 12px 16px;
      background: var(--bg-card); border-radius: var(--radius-sm);
      margin-bottom: 16px; flex-wrap: wrap;
    }
    .cal-detail-stat-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      color: var(--text-muted); margin-bottom: 2px;
    }
    .cal-detail-stat-value {
      font-family: 'JetBrains Mono', monospace; font-size: 14px;
      font-weight: 600; color: var(--text-primary);
    }
    .cal-bet-row {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 0; border-bottom: 1px solid var(--border-subtle);
    }
    .cal-bet-row:last-child { border-bottom: none; }
    .cal-bet-status {
      font-family: 'JetBrains Mono', monospace; font-size: 10px; font-weight: 700;
      width: 24px; height: 24px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .cal-bet-status.win { background: var(--profit-soft); color: var(--profit); }
    .cal-bet-status.loss { background: var(--loss-soft); color: var(--loss); }
    .cal-bet-status.push { background: var(--warning-soft); color: var(--warning); }
    .cal-bet-status.pending { background: rgba(148,163,184,0.08); color: var(--text-muted); }
    .cal-bet-sport {
      font-size: 9px; font-weight: 700; text-transform: uppercase;
      padding: 2px 6px; border-radius: 4px; flex-shrink: 0;
    }
    .cal-bet-sport.nba { background: var(--loss-soft); color: var(--loss); }
    .cal-bet-sport.ncaab { background: rgba(59,130,246,0.12); color: #60a5fa; }
    .cal-bet-sport.nhl { background: var(--profit-soft); color: var(--profit); }
    .cal-bet-sport.props { background: var(--accent-soft); color: var(--accent-secondary); }
    .cal-bet-info { flex: 1; min-width: 0; }
    .cal-bet-matchup {
      font-size: 12px; font-weight: 600; color: var(--text-primary);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .cal-bet-pick { font-size: 11px; color: var(--text-tertiary); }
    .cal-bet-odds {
      font-family: 'JetBrains Mono', monospace; font-size: 11px;
      color: var(--text-secondary); flex-shrink: 0;
    }
    .cal-bet-profit {
      font-family: 'JetBrains Mono', monospace; font-size: 12px;
      font-weight: 600; flex-shrink: 0; min-width: 60px; text-align: right;
    }
    .cal-bet-profit.profit { color: var(--profit); }
    .cal-bet-profit.loss { color: var(--loss); }

    .cal-summary {
      margin-top: 16px; padding: 16px 20px;
      background: var(--bg-secondary); border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      display: flex; justify-content: space-between; flex-wrap: wrap; gap: 12px;
    }
    .cal-summary-stat { text-align: center; }
    .cal-summary-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      color: var(--text-muted); margin-bottom: 2px;
    }
    .cal-summary-value {
      font-family: 'JetBrains Mono', monospace; font-size: 14px;
      font-weight: 700; color: var(--text-primary);
    }

    @media (max-width: 768px) {
      .cal-card { padding: 16px; }
      .cal-day { min-height: 56px; padding: 4px 6px; }
      .cal-day-num { font-size: 11px; }
      .cal-day-record { display: none; }
      .cal-day-pnl { font-size: 9px; }
      .cal-detail-summary { gap: 12px; }
      .cal-summary { gap: 8px; }
      .cal-summary-value { font-size: 12px; }
    }
    @media (max-width: 480px) {
      .cal-day { min-height: 44px; padding: 3px 4px; }
      .cal-day-pnl { display: none; }
      .cal-bet-odds { display: none; }
    }

    /* ── Recommended Bets ── */
    .d35 { animation-delay: 0.175s; }
    .rec-bets-header {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap;
    }
    .rec-badge-count {
      font-size: 10px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.04em; padding: 3px 8px; border-radius: var(--radius-sm);
      background: var(--accent-soft); color: var(--accent-secondary);
    }
    .rec-badge-stake {
      font-size: 10px; font-weight: 700; padding: 3px 8px;
      border-radius: var(--radius-sm);
      background: var(--profit-soft); color: var(--profit);
      font-family: 'JetBrains Mono', monospace;
    }
    .rec-info-tip {
      position: relative; cursor: help; color: var(--text-muted); font-size: 14px;
    }
    .rec-info-tip:hover::after {
      content: attr(data-tip);
      position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
      background: var(--bg-card); border: 1px solid var(--border);
      padding: 8px 12px; border-radius: var(--radius-sm);
      font-size: 11px; color: var(--text-secondary);
      white-space: nowrap; z-index: 100;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    .rec-subtitle {
      font-size: 12px; color: var(--text-tertiary); margin: -8px 0 16px 0;
    }
    .rec-bet-card {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 16px; margin-bottom: 10px;
      border-left: 3px solid var(--text-muted); transition: all 0.25s ease;
    }
    .rec-bet-card:hover {
      border-color: var(--border); box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    }
    .rec-bet-card.high-conf { border-left-color: var(--profit); }
    .rec-bet-card.med-conf { border-left-color: var(--warning); }
    .rec-bet-top {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;
    }
    .rec-bet-top-left { display: flex; align-items: center; gap: 8px; }
    .rec-bet-pick {
      font-size: 14px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px;
    }
    .rec-bet-meta {
      font-size: 11px; color: var(--text-tertiary); margin-bottom: 10px;
    }
    .rec-bet-bottom {
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; flex-wrap: wrap;
    }
    .rec-conf-bar-wrap { flex: 1; min-width: 80px; max-width: 160px; }
    .rec-conf-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      color: var(--text-muted); margin-bottom: 3px;
    }
    .rec-conf-bar {
      height: 4px; background: rgba(148,163,184,0.08);
      border-radius: 2px; overflow: hidden;
    }
    .rec-conf-bar-fill {
      height: 100%; border-radius: 2px;
      transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
    }
    .rec-conf-bar-fill.high { background: linear-gradient(90deg, var(--profit), #4ade80); }
    .rec-conf-bar-fill.med { background: linear-gradient(90deg, var(--warning), #fbbf24); }
    .rec-conf-bar-fill.low { background: linear-gradient(90deg, var(--accent), #38bdf8); }
    .rec-stake {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px; font-weight: 700; color: var(--text-primary); text-align: right;
    }
    .rec-stake-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);
    }
    .rec-edge {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px; color: var(--profit); font-weight: 600;
    }
    .rec-risk-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .rec-risk-dot.low { background: var(--profit); box-shadow: 0 0 6px rgba(34,197,94,0.4); }
    .rec-risk-dot.med { background: var(--warning); box-shadow: 0 0 6px rgba(245,158,11,0.4); }
    .rec-risk-dot.high { background: var(--loss); box-shadow: 0 0 6px rgba(239,68,68,0.4); }
    .rec-lockin-btn {
      padding: 6px 14px; border-radius: var(--radius-sm);
      border: 1px solid var(--accent); background: transparent;
      color: var(--accent); font-size: 12px; font-weight: 600;
      font-family: inherit; cursor: pointer; transition: all 0.2s; white-space: nowrap;
    }
    .rec-lockin-btn:hover { background: var(--accent); color: #fff; }
    .rec-lockin-btn.locked {
      border-color: var(--profit); background: var(--profit-soft);
      color: var(--profit); cursor: default;
    }
    .rec-summary {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 16px; margin-top: 12px;
      display: flex; align-items: center; justify-content: space-between;
      gap: 16px; flex-wrap: wrap;
    }
    .rec-summary-stat { text-align: center; }
    .rec-summary-label {
      font-size: 10px; font-weight: 600; text-transform: uppercase;
      color: var(--text-muted); margin-bottom: 2px;
    }
    .rec-summary-value {
      font-family: 'JetBrains Mono', monospace; font-size: 14px;
      font-weight: 700; color: var(--text-primary);
    }
    .rec-bankroll-bar {
      width: 100%; height: 4px; background: rgba(148,163,184,0.08);
      border-radius: 2px; overflow: hidden; margin-top: 8px;
    }
    .rec-bankroll-bar-fill {
      height: 100%; border-radius: 2px;
      background: linear-gradient(90deg, var(--accent), var(--profit));
      transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
    }
    .rec-empty {
      background: var(--bg-card); border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg); padding: 32px;
      text-align: center; color: var(--text-muted); font-size: 13px;
    }
    .rec-empty a { color: var(--accent-secondary); text-decoration: none; }
    .rec-empty a:hover { color: var(--accent); }
    @media (max-width: 768px) {
      .rec-bet-bottom { gap: 8px; }
      .rec-conf-bar-wrap { max-width: 120px; }
      .rec-summary { gap: 10px; }
      .rec-summary-value { font-size: 12px; }
    }
  </style>
</head>
<body>

  <!-- Auth Gate -->
  <div class="auth-gate" id="auth-gate">
    <div class="logo-mark">EF</div>
    <h2>Edge Factor Elite</h2>
    <p>AI-powered sports investment platform</p>
    <button class="google-btn" id="google-btn">
      <svg width="18" height="18" viewBox="0 0 48 48">
        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
      </svg>
      Sign in with Google
    </button>
  </div>

  <!-- Navigation -->
  <nav class="nav" id="main-nav" style="display:none">
    <div class="nav-inner">
      <a href="dashboard-home.html" class="nav-left">
        <div class="logo-mark">EF</div>
        <span class="logo-text">Edge Factor <span>Elite</span></span>
      </a>
      <div class="nav-center">
        <a href="dashboard-home.html" class="nav-link active">Dashboard</a>
        <a href="dashboard.html" class="nav-link">Projections</a>
        <a href="results.html" class="nav-link">Results</a>
      </div>
      <div class="nav-actions">
        <div class="dropdown-trigger" id="dropdown-trigger" onclick="window.toggleDropdown()">
          <div class="dropdown-avatar" id="nav-avatar"></div>
          <span class="dropdown-trigger-name" id="nav-name"></span>
          <span class="dropdown-chevron">&#9662;</span>
        </div>
        <div class="user-dropdown" id="user-dropdown">
          <div class="dropdown-user">
            <div class="dropdown-name" id="dd-name">User</div>
            <div class="dropdown-email" id="dd-email">user@email.com</div>
            <span class="dropdown-tier">Free</span>
          </div>
          <div class="dropdown-divider"></div>
          <a href="profile.html#settings" class="dropdown-item">Settings</a>
          <a href="profile.html#investment" class="dropdown-item">Investment Profile</a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item danger" id="signout-btn">Sign Out</button>
        </div>
        <button class="mobile-btn" id="mobile-btn" aria-label="Menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile Drawer -->
  <div class="mobile-drawer" id="mobile-drawer">
    <a href="dashboard-home.html" class="active">Dashboard</a>
    <a href="dashboard.html">Projections</a>
    <a href="results.html">Results</a>
  </div>

  <!-- Main Content -->
  <main class="page" id="main-content" style="display:none">

    <!-- Page Header -->
    <div class="page-header anim d1">
      <div class="page-greeting" id="greeting">GOOD MORNING</div>
      <h1 class="page-title">Portfolio Overview</h1>
      <p class="page-subtitle">
        Your investment performance at a glance
        <span class="subtitle-sep"></span>
        <span id="header-date"></span>
      </p>
    </div>

    <!-- Portfolio Hero -->
    <div class="hero-grid anim d2">
      <div class="stat-card">
        <div class="stat-icon indigo">&#128176;</div>
        <div class="stat-label">Portfolio Value</div>
        <div class="stat-value" id="stat-portfolio">&#8212;</div>
        <div class="stat-change">from invested capital</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon green">&#128200;</div>
        <div class="stat-label">Monthly P&amp;L</div>
        <div class="stat-value" id="stat-pnl">&#8212;</div>
        <div class="stat-change" id="stat-pnl-change">this month</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon indigo">&#127919;</div>
        <div class="stat-label">Win Rate</div>
        <div class="stat-value" id="stat-winrate">&#8212;</div>
        <div class="stat-change">across all models</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon blue">&#128203;</div>
        <div class="stat-label">Today's Picks</div>
        <div class="stat-value" id="stat-picks">&#8212;</div>
        <div class="stat-change">predictions locked</div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
      <!-- Left Column -->
      <div class="content-left">

        <!-- Model Performance -->
        <div class="section anim d3">
          <div class="section-header">
            <div class="section-title">Model Performance</div>
            <a href="results.html" class="section-link">View All Results &rarr;</a>
          </div>
          <div class="models-grid">
            <a href="dashboard.html" class="model-card nba">
              <div class="model-top">
                <span class="model-badge nba">NBA</span>
                <div class="model-status"><div class="model-dot"></div> Live</div>
              </div>
              <div class="model-name">NBA Games Model</div>
              <div class="model-stats">
                <div><div class="model-stat-label">Win Rate</div><div class="model-stat-value" id="nba-rate">0.0%</div></div>
                <div><div class="model-stat-label">Record</div><div class="model-stat-value" id="nba-record">0-0</div></div>
              </div>
              <div class="model-bar"><div class="model-bar-fill good" id="nba-bar" style="width:0%"></div></div>
            </a>
            <a href="dashboard.html" class="model-card ncaab">
              <div class="model-top">
                <span class="model-badge ncaab">NCAAB</span>
                <div class="model-status"><div class="model-dot"></div> Live</div>
              </div>
              <div class="model-name">NCAAB Games Model</div>
              <div class="model-stats">
                <div><div class="model-stat-label">Win Rate</div><div class="model-stat-value" id="ncaab-rate">0.0%</div></div>
                <div><div class="model-stat-label">Record</div><div class="model-stat-value" id="ncaab-record">0-0</div></div>
              </div>
              <div class="model-bar"><div class="model-bar-fill good" id="ncaab-bar" style="width:0%"></div></div>
            </a>
            <a href="dashboard.html" class="model-card nhl">
              <div class="model-top">
                <span class="model-badge nhl">NHL</span>
                <div class="model-status"><div class="model-dot"></div> Live</div>
              </div>
              <div class="model-name">NHL Games Model</div>
              <div class="model-stats">
                <div><div class="model-stat-label">Win Rate</div><div class="model-stat-value" id="nhl-rate">0.0%</div></div>
                <div><div class="model-stat-label">Record</div><div class="model-stat-value" id="nhl-record">0-0</div></div>
              </div>
              <div class="model-bar"><div class="model-bar-fill good" id="nhl-bar" style="width:0%"></div></div>
            </a>
            <a href="dashboard.html#props" class="model-card props">
              <div class="model-top">
                <span class="model-badge props">PROPS</span>
                <div class="model-status"><div class="model-dot"></div> Live</div>
              </div>
              <div class="model-name">Player Props Engine</div>
              <div class="model-stats">
                <div><div class="model-stat-label">Win Rate</div><div class="model-stat-value" id="props-rate">0.0%</div></div>
                <div><div class="model-stat-label">Record</div><div class="model-stat-value" id="props-record">0-0</div></div>
              </div>
              <div class="model-bar"><div class="model-bar-fill good" id="props-bar" style="width:0%"></div></div>
            </a>
          </div>
        </div>

        <!-- Today's Recommended Bets -->
        <div class="section anim d35" id="rec-bets-section" style="display:none">
          <div class="section-header">
            <div class="rec-bets-header">
              <div class="section-title">Today's Recommended Bets</div>
              <span class="rec-badge-count" id="rec-pick-count">0 picks</span>
              <span class="rec-badge-stake" id="rec-total-stake"></span>
              <span class="rec-info-tip" data-tip="Picks are sized using Kelly criterion based on your risk profile">&#9432;</span>
            </div>
          </div>
          <div class="rec-subtitle">Personalized for your risk profile</div>
          <div id="rec-bets-list"></div>
          <div id="rec-bets-summary"></div>
        </div>

        <!-- Recent Picks -->
        <div class="section anim d4">
          <div class="section-header">
            <div class="section-title">Recent Picks</div>
            <a href="results.html" class="section-link">Full History &rarr;</a>
          </div>
          <div id="picks-list">
            <div class="picks-empty">Loading picks...</div>
          </div>
        </div>

      </div>

      <!-- Right Column (Sidebar) -->
      <div class="content-right">

        <!-- Monthly Goal -->
        <div class="goal-card anim d3">
          <div class="goal-header">Monthly Goal</div>
          <div class="goal-amount"><span id="goal-current">$0</span> <span>of <span id="goal-target">$500</span></span></div>
          <div class="goal-ring-wrap">
            <svg viewBox="0 0 100 100" width="100" height="100" class="goal-svg">
              <defs>
                <linearGradient id="ring-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#00d4ff"/>
                  <stop offset="100%" stop-color="#22c55e"/>
                </linearGradient>
              </defs>
              <circle cx="50" cy="50" r="42" fill="none" stroke="rgba(148,163,184,0.08)" stroke-width="6"/>
              <circle id="goal-ring" cx="50" cy="50" r="42" fill="none" stroke="url(#ring-grad)" stroke-width="6"
                stroke-linecap="round" stroke-dasharray="263.89" stroke-dashoffset="263.89"
                transform="rotate(-90 50 50)" style="transition: stroke-dashoffset 1s cubic-bezier(0.4,0,0.2,1)"/>
              <text x="50" y="46" text-anchor="middle" fill="#f1f5f9" font-size="18" font-family="JetBrains Mono, monospace" font-weight="700" id="goal-pct-text">0%</text>
              <text x="50" y="62" text-anchor="middle" fill="#64748b" font-size="8" font-family="DM Sans, sans-serif" font-weight="600" letter-spacing="0.1em">GOAL</text>
            </svg>
          </div>
          <div class="goal-rows">
            <div class="goal-row"><span class="goal-row-label">Realized</span><span class="goal-row-value" id="goal-realized">$0</span></div>
            <div class="goal-row"><span class="goal-row-label">Pending</span><span class="goal-row-value" id="goal-pending">$0</span></div>
            <div class="goal-row"><span class="goal-row-label">Remaining</span><span class="goal-row-value" id="goal-remaining">$500</span></div>
          </div>
          <div class="goal-footer" id="goal-footer"></div>
        </div>

        <!-- Quick Actions -->
        <div class="actions-card anim d4">
          <a href="dashboard.html" class="action-btn">
            <div class="action-icon indigo">&#128202;</div>
            <span class="action-text">View Today's Picks</span>
            <span class="action-arrow">&rarr;</span>
          </a>
          <a href="dashboard.html#props" class="action-btn">
            <div class="action-icon orange">&#127942;</div>
            <span class="action-text">Player Props</span>
            <span class="action-arrow">&rarr;</span>
          </a>
          <a href="profile.html" class="action-btn">
            <div class="action-icon green">&#9881;</div>
            <span class="action-text">Investment Settings</span>
            <span class="action-arrow">&rarr;</span>
          </a>
        </div>

        <!-- Platform Status -->
        <div class="status-card anim d5">
          <div class="status-title">Platform Status</div>
          <div class="status-row"><span class="status-left"><span class="status-dot active"></span> NBA Model</span><span class="status-val live">Active</span></div>
          <div class="status-row"><span class="status-left"><span class="status-dot active"></span> NCAAB Model</span><span class="status-val live">Active</span></div>
          <div class="status-row"><span class="status-left"><span class="status-dot active"></span> NHL Model</span><span class="status-val live">Active</span></div>
          <div class="status-row"><span class="status-left"><span class="status-dot active"></span> Props Engine</span><span class="status-val live">Active</span></div>
          <div class="status-row"><span class="status-left"><span class="status-dot active"></span> Auto-Grading</span><span class="status-val live">Active</span></div>
          <div class="status-row"><span class="status-left"><span class="status-dot idle"></span> Next Pipeline</span><span class="status-val">3:00 AM EST</span></div>
        </div>

      </div>
    </div>

    <!-- Betting Calendar -->
    <div class="cal-section anim d6">
      <div class="section-header">
        <div class="section-title">Betting Calendar</div>
      </div>
      <div class="cal-card">
        <div class="cal-nav">
          <button class="cal-nav-btn" onclick="calNavMonth(-1)">&larr;</button>
          <span class="cal-month-label" id="cal-month-label">March 2026</span>
          <button class="cal-nav-btn" onclick="calNavMonth(1)">&rarr;</button>
        </div>
        <div class="cal-weekdays">
          <div class="cal-weekday">Sun</div>
          <div class="cal-weekday">Mon</div>
          <div class="cal-weekday">Tue</div>
          <div class="cal-weekday">Wed</div>
          <div class="cal-weekday">Thu</div>
          <div class="cal-weekday">Fri</div>
          <div class="cal-weekday">Sat</div>
        </div>
        <div class="cal-grid" id="cal-grid"></div>
        <div class="cal-detail" id="cal-detail" style="display:none"></div>
        <div id="cal-summary"></div>
      </div>
    </div>

  </main>

  <!-- Firebase SDK + shared auth (same as dashboard.html) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="auth.js"></script>
  <script>
    const CUTOFF = '2026-02-27';
    var nbaResultsData = null, ncaabResultsData = null, nhlResultsData = null;
    var propsJsonData = null, gameJsonData = null;
    var nhlGameJsonData = null, ncaabGameJsonData = null;
    var currentProfile = null;
    var lastRecommendations = null;
    var calYear = new Date().getFullYear(), calMonth = new Date().getMonth();

    // ── Helpers ──
    function getTrackedBets() {
      try { return JSON.parse(localStorage.getItem('efe_tracked_bets')) || []; }
      catch { return []; }
    }

    // ── Calendar Helpers ──
    function getLocalDateStr(d) {
      return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
    }
    function calcProfit(odds, units) {
      var o = parseInt(odds);
      if (isNaN(o)) return 0;
      return o > 0 ? units * (o / 100) : units * (100 / Math.abs(o));
    }
    function getUnitSize() {
      try { var s = JSON.parse(localStorage.getItem('efe_user_settings')) || {}; return s.unit_size || s.unitSize || 10; }
      catch(e) { return 10; }
    }
    function getBetsByDate() {
      var bets = getTrackedBets();
      var byDate = {};
      for (var i = 0; i < bets.length; i++) {
        var b = bets[i];
        if (!b.date) continue;
        if (!byDate[b.date]) byDate[b.date] = { bets: [], w: 0, l: 0, p: 0, pnl: 0 };
        byDate[b.date].bets.push(b);
        if (b.status === 'win') { byDate[b.date].w++; byDate[b.date].pnl += parseFloat(b.profit_units) || 0; }
        else if (b.status === 'loss') { byDate[b.date].l++; byDate[b.date].pnl += parseFloat(b.profit_units) || 0; }
        else { byDate[b.date].p++; }
      }
      return byDate;
    }

    // ── Recommended Bets ──
    function buildRecBetId(pick) {
      var today = new Date();
      var ds = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
      if (pick.type === 'prop') {
        return ds + '_prop_' + (pick.player || '').replace(/\s+/g, '_').toLowerCase() + '_' + (pick.prop_type || '');
      }
      return ds + '_' + (pick.type || 'spread') + '_' + (pick.game || '').replace(/\s+/g, '_').toLowerCase();
    }

    function generateRecommendations() {
      var ip = (currentProfile && currentProfile.investmentProfile) || {};
      var s = (currentProfile && currentProfile.settings) || {};
      var bankroll = ip.bankroll || s.bankroll || 0;
      var unitSize = ip.unitSize || s.unitSize || 10;
      var riskTolerance = ip.riskTolerance || s.riskTolerance || 'moderate';
      var kellyFraction = ip.kellyFraction || s.kellyFraction || 0.25;
      var maxBetPct = ip.maxBetPct || s.maxBetPct || 5;
      var sportsWeighting = ip.sportsWeighting || s.sportsWeighting || {};
      var useKelly = ip.kellyEnabled !== false;

      if (!bankroll) {
        try {
          var ls = JSON.parse(localStorage.getItem('efe_user_settings')) || {};
          bankroll = ls.bankroll || 0;
          unitSize = ls.unit_size || ls.unitSize || 10;
        } catch (e) {}
      }

      var hasProfile = bankroll > 0;
      var confThreshold = riskTolerance === 'conservative' ? 62 : riskTolerance === 'aggressive' ? 52 : 57;
      var maxDailyPct = riskTolerance === 'conservative' ? 8 : riskTolerance === 'aggressive' ? 25 : 15;
      var maxDailyExposure = bankroll * (maxDailyPct / 100);

      var now = new Date();
      var todayStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
      var candidates = [];

      // NBA game picks
      if (gameJsonData && gameJsonData.date === todayStr && gameJsonData.games) {
        for (var i = 0; i < gameJsonData.games.length; i++) {
          var g = gameJsonData.games[i];
          var types = ['spread', 'total', 'moneyline'];
          for (var t = 0; t < types.length; t++) {
            var type = types[t];
            var conf = 0, pick = '', line = '', odds = -110;
            if (type === 'spread' && g.spread_pick) {
              conf = g.spread_confidence || g.confidence || 0; pick = g.spread_pick;
              line = g.spread_line || ''; odds = g.spread_odds || -110;
            } else if (type === 'total' && g.total_pick) {
              conf = g.total_confidence || g.confidence || 0; pick = g.total_pick;
              line = g.total_line || ''; odds = g.total_odds || -110;
            } else if (type === 'moneyline' && g.ml_pick) {
              conf = g.ml_confidence || g.confidence || 0; pick = g.ml_pick;
              odds = g.ml_odds || -110;
            } else continue;
            if (conf >= confThreshold) {
              candidates.push({ sport: 'nba', type: type, game: g.game || g.matchup || '',
                pick: pick, line: line, odds: odds, confidence: conf, player: null, prop_type: null });
            }
          }
        }
      }

      // NBA props
      if (propsJsonData && propsJsonData.date === todayStr && propsJsonData.projections) {
        for (var i = 0; i < propsJsonData.projections.length; i++) {
          var p = propsJsonData.projections[i];
          var conf = p.confidence || p.edge || 0;
          if (conf >= confThreshold) {
            candidates.push({ sport: 'props', type: 'prop', game: p.game || p.matchup || '',
              pick: p.pick || (p.projection > p.line ? 'Over' : 'Under') + ' ' + p.line,
              line: p.line || '', odds: p.odds || -110, confidence: conf,
              player: p.player || '', prop_type: p.prop || p.market || '' });
          }
        }
      }

      // NHL game picks
      if (nhlGameJsonData && nhlGameJsonData.date === todayStr && nhlGameJsonData.games) {
        for (var i = 0; i < nhlGameJsonData.games.length; i++) {
          var g = nhlGameJsonData.games[i];
          var types = ['spread', 'total', 'moneyline'];
          for (var t = 0; t < types.length; t++) {
            var type = types[t];
            var conf = 0, pick = '', line = '', odds = -110;
            if (type === 'spread' && g.spread_pick) {
              conf = g.spread_confidence || g.confidence || 0; pick = g.spread_pick;
              line = g.spread_line || ''; odds = g.spread_odds || -110;
            } else if (type === 'total' && g.total_pick) {
              conf = g.total_confidence || g.confidence || 0; pick = g.total_pick;
              line = g.total_line || ''; odds = g.total_odds || -110;
            } else if (type === 'moneyline' && g.ml_pick) {
              conf = g.ml_confidence || g.confidence || 0; pick = g.ml_pick;
              odds = g.ml_odds || -110;
            } else continue;
            if (conf >= confThreshold) {
              candidates.push({ sport: 'nhl', type: type, game: g.game || g.matchup || '',
                pick: pick, line: line, odds: odds, confidence: conf, player: null, prop_type: null });
            }
          }
        }
      }

      // NCAAB game picks
      if (ncaabGameJsonData && ncaabGameJsonData.date === todayStr && ncaabGameJsonData.games) {
        for (var i = 0; i < ncaabGameJsonData.games.length; i++) {
          var g = ncaabGameJsonData.games[i];
          var types = ['spread', 'total', 'moneyline'];
          for (var t = 0; t < types.length; t++) {
            var type = types[t];
            var conf = 0, pick = '', line = '', odds = -110;
            if (type === 'spread' && g.spread_pick) {
              conf = g.spread_confidence || g.confidence || 0; pick = g.spread_pick;
              line = g.spread_line || ''; odds = g.spread_odds || -110;
            } else if (type === 'total' && g.total_pick) {
              conf = g.total_confidence || g.confidence || 0; pick = g.total_pick;
              line = g.total_line || ''; odds = g.total_odds || -110;
            } else if (type === 'moneyline' && g.ml_pick) {
              conf = g.ml_confidence || g.confidence || 0; pick = g.ml_pick;
              odds = g.ml_odds || -110;
            } else continue;
            if (conf >= confThreshold) {
              candidates.push({ sport: 'ncaab', type: type, game: g.game || g.matchup || '',
                pick: pick, line: line, odds: odds, confidence: conf, player: null, prop_type: null });
            }
          }
        }
      }

      // Score and sort
      for (var i = 0; i < candidates.length; i++) {
        var c = candidates[i];
        var sportKey = c.sport === 'props' ? 'nba' : c.sport;
        var sportWeight = (sportsWeighting[sportKey] || sportsWeighting[c.sport] || 10) / 10;
        var impliedProb = c.confidence / 100;
        var o = parseInt(c.odds) || -110;
        var decimalOdds = o > 0 ? (o / 100) + 1 : (100 / Math.abs(o)) + 1;
        var impliedVegas = 1 / decimalOdds;
        var edgeProxy = Math.max(0, impliedProb - impliedVegas);
        c.edge = edgeProxy;
        c.decimalOdds = decimalOdds;
        c.score = edgeProxy * impliedProb * sportWeight;
      }
      candidates.sort(function(a, b) { return b.score - a.score; });

      // Size bets
      var totalStake = 0;
      var picks = [];
      var maxPerBet = bankroll * (maxBetPct / 100);

      for (var i = 0; i < candidates.length; i++) {
        var c = candidates[i];
        if (totalStake >= maxDailyExposure) break;
        var stake;
        if (useKelly && c.edge > 0) {
          var kellyPct = (c.edge * (c.decimalOdds - 1) - (1 - c.confidence / 100)) / (c.decimalOdds - 1);
          kellyPct = Math.max(0, kellyPct) * kellyFraction;
          stake = bankroll * kellyPct;
        } else {
          stake = unitSize;
        }
        stake = Math.min(stake, maxPerBet);
        stake = Math.min(stake, maxDailyExposure - totalStake);
        if (stake < 1) continue;
        stake = Math.round(stake);
        c.stake = stake;
        c.units = parseFloat((stake / unitSize).toFixed(2));
        totalStake += stake;
        picks.push(c);
      }

      var projReturn = 0;
      for (var i = 0; i < picks.length; i++) {
        projReturn += picks[i].stake * (picks[i].edge || 0);
      }

      return { picks: picks, totalStake: totalStake, projReturn: projReturn,
        bankrollPct: bankroll > 0 ? (totalStake / bankroll * 100) : 0,
        hasProfile: hasProfile, unitSize: unitSize };
    }

    function renderRecommendations() {
      var section = document.getElementById('rec-bets-section');
      var list = document.getElementById('rec-bets-list');
      var summary = document.getElementById('rec-bets-summary');
      var now = new Date();
      var todayStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
      var hasData = (gameJsonData && gameJsonData.date === todayStr) ||
                    (propsJsonData && propsJsonData.date === todayStr) ||
                    (nhlGameJsonData && nhlGameJsonData.date === todayStr) ||
                    (ncaabGameJsonData && ncaabGameJsonData.date === todayStr);

      section.style.display = '';

      if (!hasData) {
        list.innerHTML = '<div class="rec-empty">No projections available for today. Check back when models run (3:00 AM EST).</div>';
        summary.innerHTML = '';
        document.getElementById('rec-pick-count').textContent = '0 picks';
        document.getElementById('rec-total-stake').textContent = '';
        return;
      }

      var result = generateRecommendations();
      lastRecommendations = result;

      if (!result.hasProfile) {
        list.innerHTML = '<div class="rec-empty">Set up your <a href="profile.html#investment">investment profile</a> to get personalized bet sizing and recommendations.</div>';
        summary.innerHTML = '';
        document.getElementById('rec-pick-count').textContent = '0 picks';
        document.getElementById('rec-total-stake').textContent = '';
        return;
      }

      if (result.picks.length === 0) {
        list.innerHTML = '<div class="rec-empty">No picks meet your confidence threshold today. Check back closer to game time for updated projections.</div>';
        summary.innerHTML = '';
        document.getElementById('rec-pick-count').textContent = '0 picks';
        document.getElementById('rec-total-stake').textContent = '';
        return;
      }

      document.getElementById('rec-pick-count').textContent = result.picks.length + ' pick' + (result.picks.length !== 1 ? 's' : '');
      document.getElementById('rec-total-stake').textContent = '$' + result.totalStake.toLocaleString();

      var existingBets = getTrackedBets();
      var html = '';
      for (var i = 0; i < result.picks.length; i++) {
        var p = result.picks[i];
        var confClass = p.confidence >= 65 ? 'high-conf' : p.confidence >= 55 ? 'med-conf' : '';
        var barClass = p.confidence >= 65 ? 'high' : p.confidence >= 55 ? 'med' : 'low';
        var riskClass = p.edge >= 0.08 ? 'low' : p.edge >= 0.04 ? 'med' : 'high';
        var sportLabel = p.sport === 'props' ? 'PROP' : p.sport.toUpperCase();
        var sportBadge = p.sport === 'props' ? 'props' : p.sport;
        var matchup = p.type === 'prop' ? (p.player + ' ' + p.prop_type) : p.game;
        var pickLabel = p.pick + (p.line ? ' ' + p.line : '');
        var typeLabel = p.type.charAt(0).toUpperCase() + p.type.slice(1);
        var oddsStr = parseInt(p.odds) > 0 ? '+' + p.odds : String(p.odds);
        var betId = buildRecBetId(p);
        var isLocked = existingBets.some(function(b) { return b.id === betId; });

        html += '<div class="rec-bet-card ' + confClass + '">';
        html += '<div class="rec-bet-top"><div class="rec-bet-top-left"><span class="model-badge ' + sportBadge + '">' + sportLabel + '</span>';
        html += '<span class="rec-risk-dot ' + riskClass + '" title="Risk: ' + riskClass + '"></span></div>';
        html += '<div class="rec-edge">+' + (p.edge * 100).toFixed(1) + '% edge</div></div>';
        html += '<div class="rec-bet-pick">' + matchup + '</div>';
        html += '<div class="rec-bet-meta">' + typeLabel + ' &middot; ' + pickLabel + ' &middot; ' + oddsStr + '</div>';
        html += '<div class="rec-bet-bottom">';
        html += '<div class="rec-conf-bar-wrap"><div class="rec-conf-label">Confidence ' + p.confidence.toFixed(0) + '%</div>';
        html += '<div class="rec-conf-bar"><div class="rec-conf-bar-fill ' + barClass + '" style="width:' + Math.min(100, p.confidence) + '%"></div></div></div>';
        html += '<div class="rec-stake"><div class="rec-stake-label">Stake</div>$' + p.stake + ' (' + p.units.toFixed(1) + 'u)</div>';
        if (isLocked) {
          html += '<button class="rec-lockin-btn locked" disabled>&#10003; Locked</button>';
        } else {
          html += '<button class="rec-lockin-btn" onclick="lockInBet(' + i + ')">Lock In</button>';
        }
        html += '</div></div>';
      }
      list.innerHTML = html;

      var sh = '<div class="rec-summary">';
      sh += '<div class="rec-summary-stat"><div class="rec-summary-label">Total Stake</div><div class="rec-summary-value">$' + result.totalStake.toLocaleString() + '</div></div>';
      sh += '<div class="rec-summary-stat"><div class="rec-summary-label">Proj. Return</div><div class="rec-summary-value" style="color:var(--profit)">+$' + result.projReturn.toFixed(0) + '</div></div>';
      sh += '<div class="rec-summary-stat"><div class="rec-summary-label">Bankroll Used</div><div class="rec-summary-value">' + result.bankrollPct.toFixed(1) + '%</div></div>';
      sh += '<div style="width:100%"><div class="rec-bankroll-bar"><div class="rec-bankroll-bar-fill" style="width:' + Math.min(100, result.bankrollPct) + '%"></div></div></div>';
      sh += '</div>';
      summary.innerHTML = sh;
    }

    function lockInBet(idx) {
      if (!lastRecommendations || !lastRecommendations.picks[idx]) return;
      var p = lastRecommendations.picks[idx];
      var now = new Date();
      var todayStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
      var bet = {
        id: buildRecBetId(p),
        date: todayStr,
        sport: p.sport === 'props' ? 'nba' : p.sport,
        type: p.type,
        player: p.player || null,
        game: p.game || '',
        prop_type: p.prop_type || null,
        pick: p.pick,
        line: p.line || null,
        odds: String(p.odds),
        units: p.units,
        status: 'pending',
        source: 'recommended_bets',
        model_confidence: p.confidence,
        locked_at: now.toISOString()
      };
      var bets = getTrackedBets();
      var exists = bets.some(function(b) { return b.id === bet.id; });
      if (!exists) {
        bets.push(bet);
        localStorage.setItem('efe_tracked_bets', JSON.stringify(bets));
      }
      var btns = document.querySelectorAll('.rec-lockin-btn');
      if (btns[idx]) {
        btns[idx].innerHTML = '&#10003; Locked';
        btns[idx].classList.add('locked');
        btns[idx].disabled = true;
      }
      renderBettingCalendar();
      renderCalendarSummary();
    }

    // ── Auto-Grading ──
    function autoGradeHomeTrackedBets() {
      var bets = getTrackedBets();
      var changed = false;
      var allPicks = [];
      function collectPicks(data) {
        if (!data || !data.days) return;
        for (var i = 0; i < data.days.length; i++) {
          var picks = data.days[i].picks || [];
          for (var j = 0; j < picks.length; j++) allPicks.push(picks[j]);
        }
      }
      collectPicks(nbaResultsData);
      collectPicks(ncaabResultsData);
      collectPicks(nhlResultsData);
      for (var i = 0; i < bets.length; i++) {
        var bet = bets[i];
        if (bet.status !== 'pending') continue;
        var matched = null;
        if (bet.type === 'prop') {
          for (var j = 0; j < allPicks.length; j++) {
            var p = allPicks[j];
            if (p.player && bet.player &&
                p.player.toLowerCase() === bet.player.toLowerCase() &&
                p.prop === bet.prop_type &&
                parseFloat(p.line) === parseFloat(bet.line) &&
                p.hit !== undefined && p.hit !== null) { matched = p; break; }
          }
        } else {
          for (var j = 0; j < allPicks.length; j++) {
            var p = allPicks[j];
            if (p.game && bet.game && p.game === bet.game &&
                p.type === bet.type &&
                p.hit !== undefined && p.hit !== null) { matched = p; break; }
          }
        }
        if (matched) {
          bet.status = matched.hit === true ? 'win' : 'loss';
          bet.actual = matched.result != null ? String(matched.result) : null;
          var u = parseFloat(bet.units) || 1;
          bet.profit_units = bet.status === 'win' ? calcProfit(parseInt(bet.odds) || -110, u) : -u;
          changed = true;
        }
      }
      if (changed) localStorage.setItem('efe_tracked_bets', JSON.stringify(bets));
    }

    // ── Calendar Rendering ──
    function calNavMonth(delta) {
      calMonth += delta;
      if (calMonth > 11) { calMonth = 0; calYear++; }
      else if (calMonth < 0) { calMonth = 11; calYear--; }
      renderBettingCalendar();
      renderCalendarSummary();
    }
    function renderBettingCalendar() {
      var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      document.getElementById('cal-month-label').textContent = months[calMonth] + ' ' + calYear;
      var firstDay = new Date(calYear, calMonth, 1).getDay();
      var daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();
      var daysInPrev = new Date(calYear, calMonth, 0).getDate();
      var today = getLocalDateStr(new Date());
      var betsByDate = getBetsByDate();
      var unitSize = getUnitSize();
      var html = '';
      for (var i = firstDay - 1; i >= 0; i--) {
        var day = daysInPrev - i;
        var pm = calMonth === 0 ? 11 : calMonth - 1;
        var py = calMonth === 0 ? calYear - 1 : calYear;
        var ds = py + '-' + String(pm + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
        html += buildCalDayHtml(ds, day, today, betsByDate, unitSize, true);
      }
      for (var d = 1; d <= daysInMonth; d++) {
        var ds = calYear + '-' + String(calMonth + 1).padStart(2, '0') + '-' + String(d).padStart(2, '0');
        html += buildCalDayHtml(ds, d, today, betsByDate, unitSize, false);
      }
      var totalCells = firstDay + daysInMonth;
      var rem = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
      for (var i = 1; i <= rem; i++) {
        var nm = calMonth === 11 ? 0 : calMonth + 1;
        var ny = calMonth === 11 ? calYear + 1 : calYear;
        var ds = ny + '-' + String(nm + 1).padStart(2, '0') + '-' + String(i).padStart(2, '0');
        html += buildCalDayHtml(ds, i, today, betsByDate, unitSize, true);
      }
      document.getElementById('cal-grid').innerHTML = html;
      closeCalDetail();
    }
    function buildCalDayHtml(dateStr, dayNum, today, betsByDate, unitSize, isOtherMonth) {
      var info = betsByDate[dateStr];
      var cls = 'cal-day';
      if (isOtherMonth) cls += ' cal-other-month';
      if (dateStr === today) cls += ' cal-today';
      if (info) cls += ' cal-has-bets';
      var onclick = info ? ' onclick="openCalDay(\'' + dateStr + '\')"' : '';
      var inner = '<span class="cal-day-num">' + dayNum + '</span>';
      if (info) {
        var rec = info.w + '-' + info.l;
        var rc = 'pending';
        if (info.w > 0 && info.l === 0) rc = 'win';
        else if (info.l > 0 && info.w === 0) rc = 'loss';
        else if (info.w > 0 && info.l > 0) rc = 'mixed';
        if (info.p > 0 && info.w === 0 && info.l === 0) { rec = info.p + 'P'; rc = 'pending'; }
        inner += '<span class="cal-day-record ' + rc + '">' + rec + '</span>';
        var dp = info.pnl * unitSize;
        if (info.w > 0 || info.l > 0) {
          var pc = dp >= 0 ? 'profit' : 'loss';
          inner += '<span class="cal-day-pnl ' + pc + '">' + (dp >= 0 ? '+' : '') + '$' + Math.abs(dp).toFixed(0) + '</span>';
        }
        var dc = (info.p > 0 && info.w === 0 && info.l === 0) ? 'pending' : (dp >= 0 ? 'profit' : 'loss');
        inner += '<span class="cal-day-dot ' + dc + '"></span>';
      }
      return '<div class="' + cls + '" data-date="' + dateStr + '"' + onclick + '>' + inner + '</div>';
    }

    // ── Day Detail Panel ──
    function openCalDay(dateStr) {
      var betsByDate = getBetsByDate();
      var info = betsByDate[dateStr];
      if (!info) return;
      var unitSize = getUnitSize();
      var days = document.querySelectorAll('.cal-day');
      for (var i = 0; i < days.length; i++) days[i].classList.remove('cal-selected');
      var dayEl = document.querySelector('.cal-day[data-date="' + dateStr + '"]');
      if (dayEl) dayEl.classList.add('cal-selected');
      var dt = new Date(dateStr + 'T12:00:00');
      var dateLabel = dt.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
      var total = info.w + info.l + info.p;
      var wr = (info.w + info.l) > 0 ? ((info.w / (info.w + info.l)) * 100).toFixed(0) : '0';
      var dp = info.pnl * unitSize;
      var pSign = dp >= 0 ? '+' : '';
      var pCls = dp >= 0 ? 'profit' : 'loss';
      var h = '<div class="cal-detail-header"><span class="cal-detail-date">' + dateLabel + '</span>';
      h += '<button class="cal-detail-close" onclick="closeCalDetail()">&times;</button></div>';
      h += '<div class="cal-detail-summary">';
      h += '<div><div class="cal-detail-stat-label">Bets</div><div class="cal-detail-stat-value">' + total + '</div></div>';
      h += '<div><div class="cal-detail-stat-label">Record</div><div class="cal-detail-stat-value">' + info.w + '-' + info.l + (info.p > 0 ? '-' + info.p + 'P' : '') + '</div></div>';
      h += '<div><div class="cal-detail-stat-label">Win Rate</div><div class="cal-detail-stat-value">' + wr + '%</div></div>';
      h += '<div><div class="cal-detail-stat-label">P&amp;L</div><div class="cal-detail-stat-value" style="color:var(--' + pCls + ')">' + pSign + '$' + Math.abs(dp).toFixed(2) + '</div></div>';
      h += '</div>';
      for (var i = 0; i < info.bets.length; i++) {
        var bet = info.bets[i];
        var sc = bet.status === 'win' ? 'win' : bet.status === 'loss' ? 'loss' : bet.status === 'push' ? 'push' : 'pending';
        var sl = bet.status === 'win' ? 'W' : bet.status === 'loss' ? 'L' : bet.status === 'push' ? 'P' : '\u2014';
        var sp = (bet.sport || '').toLowerCase();
        if (bet.type === 'prop') sp = 'props';
        var spLabel = bet.type === 'prop' ? 'PROP' : (bet.sport || '').toUpperCase();
        var matchup = bet.game || ((bet.player || '') + ' ' + (bet.prop_type || ''));
        var pick = bet.pick || '';
        if (bet.model_confidence) pick += ' (' + parseFloat(bet.model_confidence).toFixed(0) + '%)';
        var oddsStr = bet.odds ? (parseInt(bet.odds) > 0 ? '+' : '') + bet.odds : '';
        var profDollars = (parseFloat(bet.profit_units) || 0) * unitSize;
        var profStr = '', profCls = '';
        if (bet.status === 'win') { profStr = '+$' + profDollars.toFixed(2); profCls = 'profit'; }
        else if (bet.status === 'loss') { profStr = '-$' + Math.abs(profDollars).toFixed(2); profCls = 'loss'; }
        else { profStr = '\u2014'; }
        h += '<div class="cal-bet-row"><span class="cal-bet-status ' + sc + '">' + sl + '</span>';
        h += '<span class="cal-bet-sport ' + sp + '">' + spLabel + '</span>';
        h += '<div class="cal-bet-info"><div class="cal-bet-matchup">' + matchup + '</div><div class="cal-bet-pick">' + pick + '</div></div>';
        h += '<span class="cal-bet-odds">' + oddsStr + '</span>';
        h += '<span class="cal-bet-profit ' + profCls + '">' + profStr + '</span></div>';
      }
      var el = document.getElementById('cal-detail');
      el.style.display = 'none';
      el.innerHTML = h;
      void el.offsetHeight;
      el.style.display = '';
    }
    function closeCalDetail() {
      var el = document.getElementById('cal-detail');
      el.style.display = 'none';
      el.innerHTML = '';
      var days = document.querySelectorAll('.cal-day');
      for (var i = 0; i < days.length; i++) days[i].classList.remove('cal-selected');
    }

    // ── Calendar Summary ──
    function renderCalendarSummary() {
      var bets = getTrackedBets();
      var unitSize = getUnitSize();
      var mp = calYear + '-' + String(calMonth + 1).padStart(2, '0');
      var mb = bets.filter(function(b) { return b.date && b.date.startsWith(mp); });
      if (mb.length === 0) { document.getElementById('cal-summary').innerHTML = ''; return; }
      var w = 0, l = 0, pend = 0, tPnl = 0, dailyPnl = {};
      for (var i = 0; i < mb.length; i++) {
        var b = mb[i];
        if (b.status === 'win') { w++; tPnl += (parseFloat(b.profit_units) || 0) * unitSize; }
        else if (b.status === 'loss') { l++; tPnl += (parseFloat(b.profit_units) || 0) * unitSize; }
        else { pend++; }
        if (b.date && (b.status === 'win' || b.status === 'loss')) {
          if (!dailyPnl[b.date]) dailyPnl[b.date] = 0;
          dailyPnl[b.date] += (parseFloat(b.profit_units) || 0) * unitSize;
        }
      }
      var ts = w + l;
      var wr = ts > 0 ? ((w / ts) * 100).toFixed(1) : '0.0';
      var stake = 0;
      for (var i = 0; i < mb.length; i++) {
        if (mb[i].status === 'win' || mb[i].status === 'loss') stake += (parseFloat(mb[i].units) || 1) * unitSize;
      }
      var roi = stake > 0 ? ((tPnl / stake) * 100).toFixed(1) : '0.0';
      var pSign = tPnl >= 0 ? '+' : '';
      var pCls = tPnl >= 0 ? 'profit' : 'loss';
      var h = '<div class="cal-summary">';
      h += '<div class="cal-summary-stat"><div class="cal-summary-label">Total Bets</div><div class="cal-summary-value">' + mb.length + '</div></div>';
      h += '<div class="cal-summary-stat"><div class="cal-summary-label">Record</div><div class="cal-summary-value">' + w + '-' + l + (pend > 0 ? '-' + pend + 'P' : '') + '</div></div>';
      h += '<div class="cal-summary-stat"><div class="cal-summary-label">Win Rate</div><div class="cal-summary-value">' + wr + '%</div></div>';
      h += '<div class="cal-summary-stat"><div class="cal-summary-label">P&amp;L</div><div class="cal-summary-value" style="color:var(--' + pCls + ')">' + pSign + '$' + Math.abs(tPnl).toFixed(2) + '</div></div>';
      h += '<div class="cal-summary-stat"><div class="cal-summary-label">ROI</div><div class="cal-summary-value">' + roi + '%</div></div>';
      var keys = Object.keys(dailyPnl);
      if (keys.length > 1) {
        var bestV = -Infinity, worstV = Infinity;
        for (var k = 0; k < keys.length; k++) {
          if (dailyPnl[keys[k]] > bestV) bestV = dailyPnl[keys[k]];
          if (dailyPnl[keys[k]] < worstV) worstV = dailyPnl[keys[k]];
        }
        h += '<div class="cal-summary-stat"><div class="cal-summary-label">Best Day</div><div class="cal-summary-value" style="color:var(--profit)">' + (bestV >= 0 ? '+' : '-') + '$' + Math.abs(bestV).toFixed(0) + '</div></div>';
        h += '<div class="cal-summary-stat"><div class="cal-summary-label">Worst Day</div><div class="cal-summary-value" style="color:var(--loss)">' + (worstV >= 0 ? '+' : '-') + '$' + Math.abs(worstV).toFixed(0) + '</div></div>';
      }
      h += '</div>';
      document.getElementById('cal-summary').innerHTML = h;
    }

    // ── Dropdown ──
    window.toggleDropdown = function() {
      document.getElementById('dropdown-trigger').classList.toggle('open');
      document.getElementById('user-dropdown').classList.toggle('open');
    };
    document.addEventListener('click', function(e) {
      var navActions = document.querySelector('.nav-actions');
      if (navActions && !navActions.contains(e.target)) {
        var trigger = document.getElementById('dropdown-trigger');
        var dd = document.getElementById('user-dropdown');
        if (trigger) trigger.classList.remove('open');
        if (dd) dd.classList.remove('open');
      }
    });

    // ── Mobile Menu ──
    var mobileBtn = document.getElementById('mobile-btn');
    if (mobileBtn) {
      mobileBtn.addEventListener('click', function() {
        document.getElementById('mobile-drawer').classList.toggle('open');
      });
    }

    // ── Google Sign-In (uses signInWithGoogle from auth.js) ──
    document.getElementById('google-btn').addEventListener('click', async function() {
      try {
        await signInWithGoogle();
      } catch (e) {
        console.error('Sign-in error:', e);
      }
    });

    // ── Sign Out (uses handleSignOut from auth.js) ──
    document.getElementById('signout-btn').addEventListener('click', function() {
      handleSignOut();
    });

    // ── Auth State (uses shared firebase instance from auth.js) ──
    firebase.auth().onAuthStateChanged(async function(user) {
      if (!user) {
        document.getElementById('auth-gate').classList.add('visible');
        document.getElementById('main-nav').style.display = 'none';
        document.getElementById('main-content').style.display = 'none';
        return;
      }

      document.getElementById('auth-gate').classList.remove('visible');
      document.getElementById('main-nav').style.display = '';
      document.getElementById('main-content').style.display = '';

      var name = user.displayName || user.email.split('@')[0] || 'User';
      var firstName = name.split(' ')[0];
      var initial = firstName.charAt(0).toUpperCase();

      // Nav avatar + name
      document.getElementById('nav-avatar').textContent = initial;
      document.getElementById('nav-name').textContent = firstName;

      // Dropdown user info
      document.getElementById('dd-name').textContent = name;
      document.getElementById('dd-email').textContent = user.email || '';

      // Greeting
      var hour = new Date().getHours();
      var greeting = hour < 12 ? 'GOOD MORNING' : hour < 18 ? 'GOOD AFTERNOON' : 'GOOD EVENING';
      document.getElementById('greeting').textContent = greeting + ', ' + firstName.toUpperCase();

      // Date
      var now = new Date();
      document.getElementById('header-date').textContent = now.toLocaleDateString('en-US', {
        month: 'long', day: 'numeric', year: 'numeric'
      });

      // Load Firestore profile via auth.js helper, then render
      var profile = await getUserProfile(user.uid);
      currentProfile = profile;
      renderPortfolioStats(profile);
      await loadData();
    });

    // ── Portfolio Stats ──
    function renderPortfolioStats(profile) {
      var ip = (profile && profile.investmentProfile) || {};
      var sp = (profile && profile.settings) || {};
      var bankroll = ip.bankroll || sp.bankroll || 0;
      var unitSize = ip.unitSize || sp.unitSize || 10;
      var monthlyTarget = ip.monthlyTarget || sp.monthlyTarget || 500;

      if (!bankroll) {
        try {
          var ls = JSON.parse(localStorage.getItem('efe_user_settings')) || {};
          bankroll = ls.bankroll || 1000;
          unitSize = ls.unit_size || ls.unitSize || 10;
        } catch (e) { bankroll = 1000; }
      }

      document.getElementById('stat-portfolio').textContent = '$' + bankroll.toLocaleString();

      // Monthly P&L
      var bets = getTrackedBets();
      var now = new Date();
      var monthStart = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-01';
      var settled = bets.filter(function(b) { return b.status && b.status !== 'pending' && b.date >= monthStart; });
      var pl = 0;
      for (var i = 0; i < settled.length; i++) {
        var b = settled[i];
        var stake = (parseFloat(b.units) || 1) * unitSize;
        if (b.status === 'win') {
          var odds = parseInt(b.odds) || -110;
          pl += odds > 0 ? stake * (odds / 100) : stake * (100 / Math.abs(odds));
        } else if (b.status === 'loss') pl -= stake;
      }
      var plSign = pl >= 0 ? '+' : '';
      document.getElementById('stat-pnl').textContent = plSign + '$' + Math.abs(pl).toFixed(0);
      var pnlEl = document.getElementById('stat-pnl');
      var pnlChangeEl = document.getElementById('stat-pnl-change');
      if (pl > 0) { pnlEl.style.color = 'var(--profit)'; pnlChangeEl.classList.add('profit'); }
      else if (pl < 0) { pnlEl.style.color = 'var(--loss)'; pnlChangeEl.classList.add('loss'); }
      pnlChangeEl.textContent = plSign + '$' + Math.abs(pl).toFixed(0) + ' this month';

      // Monthly Goal
      document.getElementById('goal-target').textContent = '$' + monthlyTarget;
      var realized = Math.max(0, pl);
      var pending = bets.filter(function(b) { return b.status === 'pending'; })
        .reduce(function(sum, b) { return sum + ((parseFloat(b.units) || 1) * unitSize); }, 0);
      var remaining = Math.max(0, monthlyTarget - realized);
      var goalPct = monthlyTarget > 0 ? Math.min(100, (realized / monthlyTarget) * 100) : 0;

      document.getElementById('goal-current').textContent = '$' + realized.toFixed(0);
      document.getElementById('goal-realized').textContent = '$' + realized.toFixed(0);
      document.getElementById('goal-pending').textContent = '$' + pending.toFixed(0);
      document.getElementById('goal-remaining').textContent = '$' + remaining.toFixed(0);

      // Ring animation
      var circumference = 2 * Math.PI * 42;
      var offset = circumference * (1 - goalPct / 100);
      setTimeout(function() {
        document.getElementById('goal-ring').setAttribute('stroke-dashoffset', offset.toFixed(2));
        document.getElementById('goal-pct-text').textContent = goalPct.toFixed(0) + '%';
      }, 300);

      // Footer
      var lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
      var daysLeft = Math.max(0, lastDay - now.getDate());
      var monthName = now.toLocaleDateString('en-US', { month: 'long' });
      document.getElementById('goal-footer').textContent = daysLeft + ' day' + (daysLeft !== 1 ? 's' : '') + ' left in ' + monthName;
    }

    // ── Data Loading ──
    async function loadData() {
      var results = await Promise.allSettled([
        fetch('results.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('ncaab_results.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('nhl_results.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('projections.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('game_projections.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('nhl_game_projections.json?t=' + Date.now()).then(function(r) { return r.json(); }),
        fetch('ncaab_projections.json?t=' + Date.now()).then(function(r) { return r.json(); }),
      ]);

      var nbaData = results[0].status === 'fulfilled' ? results[0].value : null;
      var ncaabData = results[1].status === 'fulfilled' ? results[1].value : null;
      var nhlData = results[2].status === 'fulfilled' ? results[2].value : null;
      nbaResultsData = nbaData; ncaabResultsData = ncaabData; nhlResultsData = nhlData;
      propsJsonData = results[3].status === 'fulfilled' ? results[3].value : null;
      gameJsonData = results[4].status === 'fulfilled' ? results[4].value : null;
      nhlGameJsonData = results[5].status === 'fulfilled' ? results[5].value : null;
      ncaabGameJsonData = results[6].status === 'fulfilled' ? results[6].value : null;

      // Grade each model
      var nbaStats = grade('nba', nbaData, ['spreads', 'totals', 'moneylines']);
      var ncaabStats = grade('ncaab', ncaabData, ['spreads', 'totals', 'moneylines']);
      var nhlStats = grade('nhl', nhlData, ['spreads', 'totals', 'moneylines']);
      var propsStats = grade('props', nbaData, ['props']);

      // Overall win rate
      var totalW = nbaStats.w + ncaabStats.w + nhlStats.w + propsStats.w;
      var totalL = nbaStats.l + ncaabStats.l + nhlStats.l + propsStats.l;
      var totalT = totalW + totalL;
      var overallPct = totalT > 0 ? (totalW / totalT * 100).toFixed(1) : '0.0';
      document.getElementById('stat-winrate').textContent = overallPct + '%';

      // Today's picks
      var now = new Date();
      var todayStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
      var pickCount = 0;
      if (gameJsonData && gameJsonData.date === todayStr) pickCount += (gameJsonData.games || []).length;
      if (propsJsonData && propsJsonData.date === todayStr) pickCount += (propsJsonData.projections || []).length;
      document.getElementById('stat-picks').textContent = pickCount;

      // Recent picks
      buildPicks(nbaData, ncaabData, nhlData);

      autoGradeHomeTrackedBets();
      renderBettingCalendar();
      renderCalendarSummary();
      renderRecommendations();
    }

    function grade(prefix, data, cats) {
      var w = 0, l = 0;
      if (data && data.days) {
        var days = data.days.filter(function(d) { return d.date >= CUTOFF; });
        for (var i = 0; i < days.length; i++) {
          for (var j = 0; j < cats.length; j++) {
            var cat = days[i][cats[j]];
            if (cat) { w += cat.wins || 0; l += cat.losses || 0; }
          }
        }
      }
      var total = w + l;
      var pct = total > 0 ? (w / total * 100).toFixed(1) : '0.0';

      var rateEl = document.getElementById(prefix + '-rate');
      var recordEl = document.getElementById(prefix + '-record');
      var barEl = document.getElementById(prefix + '-bar');

      if (rateEl) rateEl.textContent = pct + '%';
      if (recordEl) recordEl.textContent = w + '-' + l;
      if (barEl) {
        barEl.style.width = Math.max(2, parseFloat(pct)) + '%';
        barEl.className = 'model-bar-fill ' + (parseFloat(pct) >= 65 ? 'excellent' : 'good');
      }
      return { w: w, l: l };
    }

    function buildPicks(nba, ncaab, nhl) {
      var allPicks = [];

      function addPicks(data, sport) {
        if (!data || !data.days) return;
        for (var i = 0; i < data.days.length; i++) {
          var d = data.days[i];
          if (d.date < CUTOFF) continue;
          var picks = d.picks || [];
          for (var j = 0; j < picks.length; j++) {
            var p = Object.assign({}, picks[j], { sport: sport });
            allPicks.push(p);
          }
        }
      }

      addPicks(nba, 'NBA');
      addPicks(ncaab, 'NCAAB');
      addPicks(nhl, 'NHL');

      allPicks.sort(function(a, b) { return (b.date || '').localeCompare(a.date || ''); });
      var top6 = allPicks.slice(0, 6);

      var container = document.getElementById('picks-list');
      if (top6.length === 0) {
        container.innerHTML = '<div class="picks-empty">No graded picks yet. Results will appear after games finish.</div>';
        return;
      }

      container.innerHTML = top6.map(function(p) {
        var cls = p.hit === true ? 'win' : p.hit === false ? 'loss' : 'pending';
        var badge = p.hit === true ? 'W' : p.hit === false ? 'L' : '\u2014';
        var matchup = p.game || (p.player + ' ' + (p.prop || ''));
        var meta = p.sport + ' \u00B7 ' + (p.pick || '') + ' \u00B7 ' + (p.date || '');
        var edge = p.confidence ? p.confidence.toFixed(1) + '%' : '\u2014';
        return '<div class="pick-item">' +
          '<span class="pick-badge ' + cls + '">' + badge + '</span>' +
          '<div class="pick-info"><div class="pick-matchup">' + matchup + '</div><div class="pick-meta">' + meta + '</div></div>' +
          '<span class="pick-edge">' + edge + '</span></div>';
      }).join('');
    }
  </script>
  <script src="chat-widget.js"></script>
</body>
</html>
